getwd()
package.names <- c('picante', 'pez', 'car', 'vegan', 'MASS', 'ecodist', 'FD', 'adephylo', 'phytools')
if ( ! (package.names[1] %in% installed.packages())) {install.packages(package.names[1], dependencies = T)}
library("PACKAGE NAME")
missing_pkgs <- package.names[which(!package.names %in% installed.packages())]
install.packages(missing_pkgs)
package.names <- c('ape', 'picante', 'pez', 'car', 'vegan', 'MASS', 'ecodist', 'FD', 'adephylo')
for (pkg in package.names) {
if (!require(pkg, character.only = TRUE, quietly = TRUE)) {
install.packages(pkg)
library(pkg, character.only = TRUE)
}
}
trMB <- ape::read.tree("Data/ALLMB.CCESR.tre")
#trMB$tip.label <- gsub(" ", "_", phy$tip.label)
#trMB$tip.label <- gsub("sp.", "sp", trMB$tip.label)
length(trMB$tip.label)
head(trMB$tip.label)
BBSraw <- read.csv("Data/BBSpecies.biomass.2014.csv")[2:5]
bio.dat <- BBSraw
head(bio.dat)
bio.dat$Species <- gsub(" ", "_", bio.dat$Species)
bio.dat$Plot.Year <- paste(bio.dat$Plot, bio.dat$Year, sep = ";", collapse = NULL)   #join plot and year
bio.dat <- bio.dat[, -c(1, 2)]
bio.dat <- bio.dat[, c(3, 1, 2)]
oldsp <- c("Petalostemum_purpureum", "Petalostemum_candidum", "Petalostemum_villosum",
"Taraxicum_officinalis", "Leptoloma_cognatum", "Artemisia_.caudata._campestris",
"Achillea_millefolium.lanulosa.", "Euphorbia_.supina._maculata",
"Tragopogon_dubius_.major.",
"Ambrosia_artemisiifolia_elatior","Andropogon_gerardii", "Erigeron_canadensis")
newsp <- c("Dalea_purpurea", "Dalea_candida", "Dalea_pulchra",
"Taraxacum_croceum", "Digitaria_ciliaris", "Artemisia_caudata",
"Achillea_millefolium", "Euphorbia_supina", "Tragopogon_dubius",
"Ambrosia_artemisiifolia", "Andropogon_gerardii", "Erigeron_canadense")
for(i in 1:length(oldsp)){
cat("FROM", oldsp[i], "TO", newsp[i], "\n")
bio.dat$Species <- gsub(oldsp[i], newsp[i], bio.dat$Species)
}
#Get list of species in big bio
spnames <- unique(bio.dat$Species)
trMBcom <- drop.tip(trMB, setdiff(trMB$tip.label, spnames))
setdiff(spnames, trMBcom$tip.label)
bio.dat <- data.frame(na.omit(bio.dat))
head(bio.dat)
BBScom <- data.frame(sample2matrix(bio.dat))
BBScom[1:10, 1:10]
ls() # obtain the names of objects stored in the environment
rem <- ls()
rem
#rm(list = rem[2:10])
matched <- picante::match.phylo.comm(phy = trMBcom, comm = BBScom)
matched$comm[1:10, 1:10]
plot(matched$phy, show.tip.label = FALSE)
sum(matched$phy$edge.length) #  sum of the total branch lengths in the community
BBSpd <- pd(matched$comm, matched$phy, include.root = FALSE) # Faith's PD
head(BBSpd)
cor.test(BBSpd$SR, BBSpd$PD)
plot(BBSpd$SR, BBSpd$PD, xlab = "Species richness", ylab = "PD (millions of years)", pch = 16)
# MPD
dist.trMB <- cophenetic(matched$phy)
dist.trMB <- dist.trMB[lower.tri(dist.trMB, diag = FALSE)]
mean(dist.trMB)
# MNTD
dist.trMB2 <- cophenetic(matched$phy)
diag(dist.trMB2) <- NA
apply(dist.trMB2, 2, min, na.rm = TRUE)
mean(apply(dist.trMB2, 2, min, na.rm = TRUE))
BBSmpd <- mpd(matched$comm, cophenetic(matched$phy)) # MPD
head(BBSmpd)
BBSmntd <- mntd(matched$comm, cophenetic(matched$phy)) # MPD
head(BBSmntd)
# We can also calculate the standardized effect size of PD in each community
BBScdm <- ses.pd(matched$comm, matched$phy, runs = 99)
BBScdm <- BBScdm[, c(1, 2, 6, 7)]
head(BBScdm)
View(BBScdm)
package.names <- c('ape', 'picante', 'pez', 'car', 'vegan', 'MASS', 'ecodist', 'FD', 'adephylo')
for (pkg in package.names) {
if (!require(pkg, character.only = TRUE, quietly = TRUE)) {
install.packages(pkg)
library(pkg, character.only = TRUE)
}
}
trMB <- ape::read.tree("Data/ALLMB.CCESR.tre")
#trMB$tip.label <- gsub(" ", "_", phy$tip.label)
#trMB$tip.label <- gsub("sp.", "sp", trMB$tip.label)
length(trMB$tip.label)
head(trMB$tip.label)
BBSraw <- read.csv("Data/BBSpecies.biomass.2014.csv")[2:5]
bio.dat <- BBSraw
head(bio.dat)
bio.dat$Species <- gsub(" ", "_", bio.dat$Species)
bio.dat$Plot.Year <- paste(bio.dat$Plot, bio.dat$Year, sep = ";", collapse = NULL)   #join plot and year
bio.dat <- bio.dat[, -c(1, 2)]
bio.dat <- bio.dat[, c(3, 1, 2)]
oldsp <- c("Petalostemum_purpureum", "Petalostemum_candidum", "Petalostemum_villosum",
"Taraxicum_officinalis", "Leptoloma_cognatum", "Artemisia_.caudata._campestris",
"Achillea_millefolium.lanulosa.", "Euphorbia_.supina._maculata",
"Tragopogon_dubius_.major.",
"Ambrosia_artemisiifolia_elatior","Andropogon_gerardii", "Erigeron_canadensis")
newsp <- c("Dalea_purpurea", "Dalea_candida", "Dalea_pulchra",
"Taraxacum_croceum", "Digitaria_ciliaris", "Artemisia_caudata",
"Achillea_millefolium", "Euphorbia_supina", "Tragopogon_dubius",
"Ambrosia_artemisiifolia", "Andropogon_gerardii", "Erigeron_canadense")
for(i in 1:length(oldsp)){
cat("FROM", oldsp[i], "TO", newsp[i], "\n")
bio.dat$Species <- gsub(oldsp[i], newsp[i], bio.dat$Species)
}
#Get list of species in big bio
spnames <- unique(bio.dat$Species)
trMBcom <- drop.tip(trMB, setdiff(trMB$tip.label, spnames))
setdiff(spnames, trMBcom$tip.label)
bio.dat <- data.frame(na.omit(bio.dat))
head(bio.dat)
BBScom <- data.frame(sample2matrix(bio.dat))
BBScom[1:10, 1:10]
ls() # obtain the names of objects stored in the environment
rem <- ls()
rem
#rm(list = rem[2:10])
rem
rm(list = rem[2:10])
matched <- picante::match.phylo.comm(phy = trMBcom, comm = BBScom)
matched$comm[1:10, 1:10]
plot(matched$phy, show.tip.label = FALSE)
sum(matched$phy$edge.length) #  sum of the total branch lengths in the community
BBSpd <- pd(matched$comm, matched$phy, include.root = FALSE) # Faith's PD
head(BBSpd)
cor.test(BBSpd$SR, BBSpd$PD)
plot(BBSpd$SR, BBSpd$PD, xlab = "Species richness", ylab = "PD (millions of years)", pch = 16)
# MPD
dist.trMB <- cophenetic(matched$phy)
dist.trMB <- dist.trMB[lower.tri(dist.trMB, diag = FALSE)]
mean(dist.trMB)
# MNTD
dist.trMB2 <- cophenetic(matched$phy)
diag(dist.trMB2) <- NA
apply(dist.trMB2, 2, min, na.rm = TRUE)
mean(apply(dist.trMB2, 2, min, na.rm = TRUE))
BBSmpd <- mpd(matched$comm, cophenetic(matched$phy)) # MPD
head(BBSmpd)
BBSmntd <- mntd(matched$comm, cophenetic(matched$phy)) # MPD
head(BBSmntd)
# We can also calculate the standardized effect size of PD in each community
BBScdm <- ses.pd(matched$comm, matched$phy, runs = 99)
BBScdm <- BBScdm[, c(1, 2, 6, 7)]
head(BBScdm)
require(phytools)
# Simpson's
BBSraoD <- raoD(matched$comm, force.ultrametric(matched$phy))
BBScdm$RaoD <- BBSraoD$Dkk
# SESMPD
BBSsesmpd <- ses.mpd(matched$comm, cophenetic(matched$phy), runs = 99)
BBScdm$MPD <- BBSsesmpd[, c(2)]
BBScdm$sesMPD <- BBSsesmpd[, c(6)]
BBScdm$MPDpval <- BBSsesmpd[, c(7)]
# SESMNTD
BBSsesmntd <- ses.mntd(matched$comm, cophenetic(matched$phy), runs = 99)
BBScdm$MNTD <- BBSsesmntd[, c(2)]
BBScdm$sesMNTD <- BBSsesmntd[, c(6)]
BBScdm$MNTDpval <- BBSsesmntd[, c(7)]
# PSV or phylogenetic species variability
BBSpsv <- psv(matched$comm, matched$phy, compute.var = TRUE)
BBScdm$PSV <- BBSpsv[, 1]
# PSR or phylogenetic species richness
BBSpsr <- psr(matched$comm, matched$phy, compute.var = TRUE)
BBScdm$PSR <- BBSpsr[, 1]
# PSR or phylogenetic species evenness
BBSpse <- pse(matched$comm, matched$phy)
BBScdm$PSE <- BBSpse[, 1]
# Scheiner 2012 qD(p)
source("RFunctions/qDp.R")
# Scheiner 2012 qD(p)
source("R-Functions/qDp.R")
BBSqDp <- qDp(matched$phy, matched$comm, q = 2)
BBScdm$qDP <-	BBSqDp
head(BBScdm, 10)
BBScdm2 <- BBScdm[, c(1, 2, 5, 6, 9, 12, 13, 14, 15)]
names(BBScdm2) <- c("SR", "PD", "RaoD", "MPD", "MNTD", "PSV", "PSR", "PSE", "qDP")
head(BBScdm2)
View(BBScdm)
head(BBScdm)
BBScdm2 <- BBScdm[, c(1, 2, 3, 5, 6, 7, 9, 10, 12, 13, 14, 15)]
names(BBScdm2) <- c("SR", "PD", "sesPD", "RaoD", "MPD", "sesMPD", "MNTD", "sesMNTD", "PSV", "PSR", "PSE", "qDP")
head(BBScdm2)
scatterplotMatrix(BBScdm)
cor(BBScdm)
cor.table(BBScdm)
cor.table(na.omit(BBScdm))
plot(BBScdm2$MPD, BBScdm2$PSV, xlab = "MPD", ylab = "PSV", pch = 17)
BBSmds <- metaMDS(BBScdm2, trace = FALSE)
BBSmds <- metaMDS(BBScdm2, trace = FALSE, na.rm = TRUE)
BBSmds <- metaMDS(na.omit(BBScdm2), trace = FALSE)
ordiplot(BBSmds, type = "t", display = "species")
na.omit(BBScdm2)
?metaMDS
BBSmds <- metaMDS(na.omit(BBScdm2))
ordiplot(BBSmds, type = "t", display = "species")
BBScdm2 <- BBScdm[, c(1, 2, 5, 6, 9, 12, 13, 14, 15)]
names(BBScdm2) <- c("SR", "PD", "RaoD", "MPD", "MNTD", "PSV", "PSR", "PSE", "qDP")
head(BBScdm2)
scatterplotMatrix(BBScdm)
cor.table(na.omit(BBScdm))
plot(BBScdm2$MPD, BBScdm2$PSV, xlab = "MPD", ylab = "PSV", pch = 17)
BBSmds <- metaMDS(na.omit(BBScdm2))
ordiplot(BBSmds, type = "t", display = "species")
BBSmds <- metaMDS(na.omit(BBScdm2), trace = FALSE)
ordiplot(BBSmds, type = "t", display = "species")
