type = "b", pch = 1, cex = 1.2,
lwd = 1.5, ylim = c(-0.5, 1),
xlab = "Distance class",
ylab = "Moran's I",
cex.lab = 1.5,
cex.axis = 1.2)
abline(h = 0)
title(main = "OLS residuals", cex = 1.5)
#| eval: true
sar_nb1.5.w <- spatialreg::errorsarlm(fols2,
listw = nb1.5.w,
data = fdata,
quiet = FALSE,
zero.policy = TRUE,
na.action = na.exclude)
# this will take a while, ~10 seconds in JesÃºs's computer
#| eval: true
summary(sar_nb1.5.w)
#| eval: true
residuals_sar_nb1.5.w <- residuals(sar_nb1.5.w)
#| eval: true
autocor_sar_nb1.5.w <- ncf::correlog(x = fdata$x,
y = fdata$y,
z = residuals(sar_nb1.5.w),
na.rm = TRUE,
increment = 1,
resamp = 1)
#| eval: true
plot(autocor_sar_nb1.5.w$correlation[1:50],
type = "b", pch = 4, cex = 1.2,
lwd = 1.5, ylim = c(-0.5, 1),
xlab = "distance",
ylab = "Moran's I",
cex.lab = 1.5,
cex.axis = 1.2)
abline(h = 0)
title(main = "SARerr residuals", cex = 1.5)
#| eval: true
par(mfrow = c(2, 1))
plot(autocor_ols_res$correlation[1:50],
type = "b", pch = 1, cex = 1.2,
lwd = 1.5, ylim = c(-0.5, 1),
xlab = "distance",
ylab = "Moran's I", cex.lab = 1.5,
cex.axis = 1.2)
abline(h = 0)
title(main = "OLS residuals", cex = 1.5)
plot(autocor_sar_nb1.5.w$correlation[1:50],
type = "b", pch = 4, cex = 1.2,
lwd = 1.5, ylim = c(-0.5, 1),
xlab = "distance",
ylab = "Moran's I",
cex.lab = 1.5,
cex.axis = 1.2)
abline(h = 0)
title(main = "SARerr residuals", cex = 1.5)
#| eval: true
summary(sar_nb1.5.w)
#| eval: true
summary(fols2)
#| eval: true
fdata %>%
ggplot(aes(x = MAT, y = SR)) +
geom_point(alpha = 0.5, color = "darkgray") +
labs(x = "Mean annual temperature",
y = "Species richness") +
geom_smooth(method = "lm", # coefficient OLS
se = FALSE,
color = "blue",
linewidth = 2) +
geom_abline(intercept = coef(sar_nb1.5.w)[2], # coefficients SAR
slope = coef(sar_nb1.5.w)[3],
color = "red",
linewidth = 2)
#| eval: true
fdata %>%
ggplot(aes(x = MAP, y = SR)) +
geom_point(alpha = 0.5, color = "darkgray") +
labs(x = "Annual precipitation",
y = "Species richness") +
geom_smooth(method = "lm", # coefficient OLS
se = FALSE,
color = "blue",
linewidth = 2) +
geom_abline(intercept = coef(sar_nb1.5.w)[2], # coefficients SAR
slope = coef(sar_nb1.5.w)[4],
color = "red",
linewidth = 2)
#| eval: true
fdata %>%
ggplot(aes(x = MRD, y = SR)) +
geom_point(alpha = 0.5, color = "darkgray") +
labs(x = "Mean annual temperature",
y = "Species richness") +
geom_smooth(method = "lm", # coefficient OLS
se = FALSE,
color = "blue",
linewidth = 2) +
geom_abline(intercept = coef(sar_nb1.5.w)[2], # coefficients SAR
slope = coef(sar_nb1.5.w)[5],
color = "red",
linewidth = 2)
#| eval: true
fdata %>%
ggplot(aes(x = MRD, y = SR)) +
geom_point(alpha = 0.5, color = "darkgray") +
labs(x = "Mean root distance",
y = "Species richness") +
geom_smooth(method = "lm", # coefficient OLS
se = FALSE,
color = "blue",
linewidth = 2) +
geom_abline(intercept = coef(sar_nb1.5.w)[2], # coefficients SAR
slope = coef(sar_nb1.5.w)[5],
color = "red",
linewidth = 2)
#| eval: true
source("https://raw.githubusercontent.com/jesusNPL/BetaDivNA/master/SARr2.R")
#| eval: true
SARr2(Lfull = sar_nb1.5.w$LL, # log likelihood of the model that includes the spatial weights
Lnull = sar_nb1.5.w$logLik_lm.model, # log likelihood null model
N = nrow(fdata) # number of observation
)
sar_nb1.5.w$LL
sar_nb1.5.w$logLik_lm.model,
sar_nb1.5.w$logLik_lm.model
sar_nb1.5.w$logLik_lm.model[1]
sar_nb1.5.w$LL[1]
#| eval: true
SARr2(Lfull = sar_nb1.5.w$LL[[1]], # log likelihood of the model that includes the spatial weights
Lnull = sar_nb1.5.w$logLik_lm.model[[1]], # log likelihood null model
N = nrow(fdata) # number of observation
)
sar_nb1.5.w$dvars
sar_nb1.5.w$LL
sar_nb1.5.w$coefficients
coef(sar_nb1.5.w)
sar_nb1.5.w
summary(sar_nb1.5.w)
nrow(fdata)
summary(sar_nb1.5.w)[1]
summary(sar_nb1.5.w)[2]
summary(sar_nb1.5.w)[[1]]
summary(sar_nb1.5.w)[[4]]
summary(sar_nb1.5.w)[[5]]
summary(sar_nb1.5.w)[[6]]
summary(sar_nb1.5.w)[[10]]
summary(sar_nb1.5.w)[[15]]
summary(sar_nb1.5.w)[[12]]
sar_nb1.5.w
sar_nb1.5.w$opt$maximum
sar_nb1.5.w$opt$objective
View(SARr2)
rr2::R2_lik(sar_nb1.5.w)
rr2::R2(sar_nb1.5.w)
?rr2::R2
summary(sar_nb1.5.w)
coef(fols2)
coef(fols2)/2
sar_nb1.5.w$LL[[1]]
sar_nb1.5.w$logLik_lm.model[[1]]
sar_nb1.5.w$logLik_lm.model
sar_nb1.5.w$LLNullLlm
sar_nb1.5.w$LLNullLlm[[1]]
SARr2(Lfull = sar_nb1.5.w$LL[[1]], # log likelihood of the model that includes the spatial weights
Lnull = -8102.319#sar_nb1.5.w$logLik_lm.model[[1]], # log likelihood null model
N = nrow(fdata) # number of observation
SARr2(Lfull = sar_nb1.5.w$LL[[1]], # log likelihood of the model that includes the spatial weights
Lnull = -8102.319,#sar_nb1.5.w$logLik_lm.model[[1]], # log likelihood null model
N = nrow(fdata) # number of observation
)
SARr2(Lfull = sar_nb1.5.w$LL[[1]], # log likelihood of the model that includes the spatial weights
Lnull = sar_nb1.5.w$logLik_lm.model[[1]], # log likelihood null model
N = nrow(fdata) # number of observation
)
summary(fols2)
summary(fols)
round(0.8350546, 2)
#| eval: true
sf_use_s2(FALSE)
# Get world map from the {rnaturalearthdata} package
worldMap <- ne_countries(scale = "medium", type = "countries", returnclass = "sf")
# cCountry subset - The United States and Mexico
NApoly <- worldMap %>%
filter(admin == "United States of America" | admin == "Mexico")
# trim to study area
limsNA <- st_buffer(NApoly, dist = 1) %>%
st_bbox()
# neighboring countries
adjacentPolys <- st_touches(NApoly, worldMap)
neighbours <- worldMap %>%
slice(pluck(adjacentPolys, 1))
#| eval: true
library(scico)
library(rnaturalearth)
library(smoothr)
library(tidyverse)
library(terra)
library(sf)
library(terra)
library(sf)
#| eval: true
# to sf object, specifying variables with coordinates and projection
oaks_occ_sf <- st_as_sf(oaks_occ, coords = c("Longitude", "Latitude"), crs = 4326) %>%
#group_by(species) %>%
st_cast("MULTIPOINT") %>%
group_by(Species) %>%
summarize()
#| eval: false
packages <- c("tidyverse", "sf", "scico", "rnaturalearth",
"rnaturalearthdata", "smoothr", "sp", "viridis",
"terra", "spdep", "ncf",
"spatialreg", "rasterVis", "RColorBrewer")
# Package vector names
#| eval: true
library(scico)
#| eval: false
# Install packages not yet installed
installed_packages <- packages %in% rownames(installed.packages())
if (any(installed_packages == FALSE)) {
install.packages(packages[!installed_packages], dependencies = TRUE)
}
#| eval: true
library(scico)
library(rnaturalearth)
library(smoothr)
library(tidyverse)
library(terra)
library(sf)
#| eval: true
sf_use_s2(FALSE)
# Get world map from the {rnaturalearthdata} package
worldMap <- ne_countries(scale = "medium",
type = "countries",
returnclass = "sf")
# cCountry subset - The United States and Mexico
NApoly <- worldMap %>%
filter(admin == "United States of America" | admin == "Mexico")
# trim to study area
limsNA <- st_buffer(NApoly, dist = 1) %>%
st_bbox()
# neighboring countries
adjacentPolys <- st_touches(NApoly, worldMap)
neighbours <- worldMap %>%
slice(pluck(adjacentPolys, 1))
#| eval: true
ggplot() +
geom_sf(data = neighbours, color = "white") +
geom_sf(data = NApoly) +
coord_sf(
xlim = c(limsNA["xmin"], limsNA["xmax"]),
ylim = c(limsNA["ymin"], limsNA["ymax"])
) +
theme(
plot.background = element_rect(fill = "#f1f2f3"),
panel.background = element_rect(fill = "lightblue"),
panel.grid = element_blank(),
line = element_blank(),
rect = element_blank()
)
#| eval: true
ggplot() +
geom_sf(data = neighbours, color = "white") +
geom_sf(data = NApoly) +
coord_sf(
xlim = c(-125, -65),
ylim = c(10, 50)
) +
theme(
plot.background = element_rect(fill = "#f1f2f3"),
panel.background = element_rect(fill = "lightblue"),
panel.grid = element_blank(),
line = element_blank(),
rect = element_blank()
)
#| eval: true
oaks_occ <- read_delim("Data/OCC/live.oaks.txt") %>%
filter(Species != "Hybrid") # removing hybrid observations
oaks_occ %>%
count(Species) # check how many species and how many observations per species
# Visualize
oaks_occ %>%
count(Species) %>%
ggplot(aes(x = n)) +
geom_histogram() +
xlab("Number of observations")
#| eval: true
# to sf object, specifying variables with coordinates and projection
oaks_occ_sf <- st_as_sf(oaks_occ, coords = c("Longitude", "Latitude"), crs = 4326) %>%
#group_by(species) %>%
st_cast("MULTIPOINT") %>%
group_by(Species) %>%
summarize()
glimpse(oaks_occ_sf)
oaks_occ_sf <- st_as_sf(oaks_occ, coords = c("Longitude", "Latitude"), crs = 4326) %>%
#group_by(species) %>%
st_cast("MULTIPOINT") %>%
group_by(Species)
#| eval: true
# to sf object, specifying variables with coordinates and projection
oaks_occ_sf <- st_as_sf(oaks_occ, coords = c("Longitude", "Latitude"), crs = 4326) %>%
#group_by(species) %>%
st_cast("MULTIPOINT") %>%
group_by(Species) %>%
summarize()
glimpse(oaks_occ_sf)
oaks_occ_sf <- st_as_sf(oaks_occ, coords = c("Longitude", "Latitude"), crs = 4326) %>%
#group_by(species) %>%
st_cast("MULTIPOINT")
glimpse(oaks_occ_sf)
ggplot() +
geom_sf(data = neighbours, color = "white") +
geom_sf(data = NApoly) +
geom_sf(data = oaks_occ_sf, aes(color = Species), alpha = 0.7) +
coord_sf(
xlim = c(-125, -65),
ylim = c(10, 50)
) +
theme(
plot.background = element_rect(fill = "#f1f2f3"),
panel.background = element_rect(fill = "lightblue"),
panel.grid = element_blank(),
line = element_blank(),
rect = element_blank()
)
#| eval: true
# to sf object, specifying variables with coordinates and projection
oaks_occ_sf <- st_as_sf(oaks_occ, coords = c("Longitude", "Latitude"), crs = 4326) %>%
#group_by(species) %>%
st_cast("MULTIPOINT") %>%
group_by(Species) %>%
summarize()
glimpse(oaks_occ_sf)
#| eval: true
ggplot() +
geom_sf(data = neighbours, color = "white") +
geom_sf(data = NApoly) +
geom_sf(data = oaks_occ_sf, aes(color = Species), alpha = 0.7) +
coord_sf(
xlim = c(-125, -65),
ylim = c(10, 50)
) +
theme(
plot.background = element_rect(fill = "#f1f2f3"),
panel.background = element_rect(fill = "lightblue"),
panel.grid = element_blank(),
line = element_blank(),
rect = element_blank()
)
library(tidyverse)
#| eval: false
#| echo: true
library(tidyverse)
dat <- read.table("data/live.oaks.txt")
glimpse(dat)
#| eval: false
#| echo: true
library(tidyverse)
dat <- read_table("data/live.oaks.txt")
glimpse(dat)
read_table("data/live.oaks.txt")
oaks_occ_sf <- st_as_sf(oaks_occ, coords = c("Longitude", "Latitude"), crs = 4326) %>%
#group_by(species) %>%
st_cast("MULTIPOINT")
unique(oaks_occ$Species)
#| eval: true
ggplot() +
geom_sf(data = neighbours, color = "white") +
geom_sf(data = NApoly) +
geom_sf(data = oaks_occ_sf, aes(color = Species), alpha = 0.7) +
coord_sf(
xlim = c(-125, -65),
ylim = c(10, 50)
) +
theme(
plot.background = element_rect(fill = "#f1f2f3"),
panel.background = element_rect(fill = "lightblue"),
panel.grid = element_blank(),
line = element_blank(),
rect = element_blank()
)
#| eval: true
# Observations to convex hull
oaks_CH <- st_convex_hull(oaks_occ_sf)
# plot hulls
ggplot() +
geom_sf(data = neighbours, color = "white") +
geom_sf(data = NApoly) +
geom_sf(data = oaks_CH, aes(fill = Species), alpha = 0.7) +
scale_fill_scico_d(palette = "davos", direction = -1, end = 0.9, guide = FALSE) +
coord_sf(
xlim = c(-125, -65),
ylim = c(10, 50)
) +
theme(
plot.background = element_rect(fill = "#f1f2f3"),
panel.background = element_rect(fill = "lightblue"),
panel.grid = element_blank(),
line = element_blank(),
rect = element_blank()
)
#| eval: true
# Observations to convex hull
oaks_CH <- st_convex_hull(oaks_occ_sf)
# plot hulls
ggplot() +
geom_sf(data = neighbours, color = "white") +
geom_sf(data = NApoly) +
geom_sf(data = oaks_CH, aes(fill = Species), alpha = 0.7) +
scale_fill_scico_d(palette = "davos", direction = -1, end = 0.9) +
coord_sf(
xlim = c(-125, -65),
ylim = c(10, 50)
) +
theme(
plot.background = element_rect(fill = "#f1f2f3"),
panel.background = element_rect(fill = "lightblue"),
panel.grid = element_blank(),
line = element_blank(),
rect = element_blank()
)
#| eval: true
# Smoothed convex hulls
oaks_SCH <- st_convex_hull(oaks_occ_sf) %>%
smoothr::smooth()
# Observations to convex hull
oaks_CH <- st_convex_hull(oaks_occ_sf)
# Smoothed convex hulls
oaks_SCH <- st_convex_hull(oaks_occ_sf) %>%
smoothr::smooth()
#| eval: true
# to sf object, specifying variables with coordinates and projection
oaks_occ_sf <- st_as_sf(oaks_occ, coords = c("Longitude", "Latitude"), crs = 4326) %>%
#group_by(species) %>%
st_cast("MULTIPOINT") %>%
group_by(Species) %>%
summarize()
glimpse(oaks_occ_sf)
unique(oaks_occ$Species)
#| eval: true
ggplot() +
geom_sf(data = neighbours, color = "white") +
geom_sf(data = NApoly) +
geom_sf(data = oaks_occ_sf, aes(color = Species), alpha = 0.7) +
coord_sf(
xlim = c(-125, -65),
ylim = c(10, 50)
) +
theme(
plot.background = element_rect(fill = "#f1f2f3"),
panel.background = element_rect(fill = "lightblue"),
panel.grid = element_blank(),
line = element_blank(),
rect = element_blank()
)
#| eval: true
# Observations to convex hull
oaks_CH <- st_convex_hull(oaks_occ_sf)
# plot hulls
ggplot() +
geom_sf(data = neighbours, color = "white") +
geom_sf(data = NApoly) +
geom_sf(data = oaks_CH, aes(fill = Species), alpha = 0.7) +
scale_fill_scico_d(palette = "davos", direction = -1, end = 0.9) +
coord_sf(
xlim = c(-125, -65),
ylim = c(10, 50)
) +
theme(
plot.background = element_rect(fill = "#f1f2f3"),
panel.background = element_rect(fill = "lightblue"),
panel.grid = element_blank(),
line = element_blank(),
rect = element_blank()
)
#| eval: true
# Smoothed convex hulls
oaks_SCH <- st_convex_hull(oaks_occ_sf) %>%
smoothr::smooth()
# plot smoothed hulls
ggplot() +
geom_sf(data = neighbours, color = "white") +
geom_sf(data = NApoly) +
geom_sf(data = oaks_SCH, aes(fill = Species), alpha = 0.7) +
scale_fill_scico_d(palette = "davos", direction = -1, end = 0.9, guide = FALSE) +
coord_sf(
xlim = c(-125, -65),
ylim = c(10, 50)
) +
theme(
plot.background = element_rect(fill = "#f1f2f3"),
panel.background = element_rect(fill = "lightblue"),
panel.grid = element_blank(),
line = element_blank(),
rect = element_blank()
)
#| eval: true
franges <- st_read("Data/Ranges/Furnarii_ranges_geo.shp")
#| eval: true
class(franges)
#| eval: true
glimpse(franges)
View(franges)
franges %>% sample_n(n = 100)
franges %>% sample_n(100)
x<- franges %>% sample_n(100)
View(x)
x<- franges %>% sample_n(652/2)
View(x)
x<- franges %>% sample_n(652/3)
View(x)
st_write(x, "Data/furnariides_sample.shp")
